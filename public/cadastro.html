<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="">
    <link rel="stylesheet" href="./css/style.cad.css">
    <title>DRAGON BALL | CADASTRO</title>
</head>

<body>
    <div class="principal">
        <div class="container2">
            <div class="login_cadastro">
                <h4 onclick="cadastro()" id="cadastroBotao">Crie sua conta</h4 >
                <h4 onclick="login()" id="loginBotao">Entrar</h4>
            </div>
            
            <div class="campos" id="bloco_cadastro">
                <input type="text" id="input_nome" placeholder="Nome"> <br>
                <input type="text" id="input_email" placeholder="Email"> <br>
                <input type="password" id="input_senha" placeholder="Senha"> <br>
                <input type="password" id="input_senha2" placeholder="Confirmar senha"> <br>
               <div id="res"><span class="rodape">Os campos devem ser preenchidos</span><br></div>
            </div> 
            <div class="campos" id="bloco_login">
                <input type="text" placeholder="Email" id="input_email_login" /><br />
                <input type="password" placeholder="Senha" id="input_senha_login" />
                 <div id="msg"><span class="rodape">Os campos devem ser preenchidos</span><br></div>
            </div>
            
            <div class="botao">
                <button onclick="cadastrar()" id="botao_cadastro">Cadastrar</button>
                <button onclick="entrar()" id="botao_login">Entrar</button>
            </div>
        </div>
    </div>


</body>

</html>
<script>
    bloco_login.style.display = "none"
    botao_login.style.display = "none"

    function login() {
        loginBotao.style="border-bottom: 3px solid orangered;  transform: scale(1.03); transition: all 0.2s ease-in-out;" 
        cadastroBotao.style="border-bottom: none;"   
        bloco_login.style = "display: block; opacity: 1; transform: translateY(0);"
        botao_login.style = "display: block; opacity: 1; transform: translateY(0);"
        bloco_cadastro.style = "display: none; opacity: 0; transform: translateY(20px); transition: opacity 0.4s ease, transform 0.4s ease;"
        botao_cadastro.style = "display: none; opacity: 0; transform: translateY(20px); transition: opacity 0.4s ease, transform 0.4s ease;"
    }
     function cadastro() {
        cadastroBotao.style="border-bottom: 3px solid orangered;  transform: scale(1.03); transition: all 0.2s ease-in-out;"  
        loginBotao.style="border-bottom: none;" 
        bloco_login.style = "display: none; opacity: 0; transform: translateY(20px); transition: opacity 0.4s ease, transform 0.4s ease;"
        botao_login.style = "display: none; opacity: 0; transform: translateY(20px); transition: opacity 0.4s ease, transform 0.4s ease;"
        bloco_cadastro.style = "display: block; opacity: 1; transform: translateY(0);"
        botao_cadastro.style = "display: block; opacity: 1; transform: translateY(0);"
    }

    function cadastrar() {
        var nome = input_nome.value;
        var nomeVar = nome.trim();
        var email = input_email.value;
        var emailVar = email.trim();
        var senhaVar = input_senha.value;
        var senhaCon = input_senha2.value;
        var senhaTamanho = senhaVar.length;
        var senhaMinuscula = senhaVar.toLowerCase();
        var msg = ''

        // VALIDAÇÃO DE SENHA
        var cont = 0
        var numeros = '1234567890'
        var senhaTemNum = false
        while (cont < senhaTamanho) {
            console.log(`CHEGOU AQUI NO WHILLE`)
            if (senhaVar.includes(numeros[cont])) {
                senhaTemNum = true
                break;
            } else {
                msg = `<span style="color: red; font-weight: bold;"> *A senha não atende todos requisitos </span>`
            }
            cont++
            console.log(msg)
        }
        // VALIDAÇÕES
        if (nomeVar == '' || emailVar == '' || senhaVar == '' || senhaCon == '') {
            msg = `<span style="color: red; font-weight: bold;">*Ainda faltam campos para preencher!</span>`
        } else if (!emailVar.includes('@gmail.com') && !emailVar.includes('@sptech.school')) {
            msg = `<span style="color: red; font-weight: bold;">*Formato de email inválido </span>`

        } else if (senhaTamanho < 8 || senhaVar == senhaMinuscula || senhaTemNum == false || (!senhaVar.includes('@') && !senhaVar.includes('&') && !senhaVar.includes('#') && !senhaVar.includes('$') && !senhaVar.includes('!'))) {
            msg = `<span style="color: red; font-weight: bold;"> *senha deve ter pelo menos 1 caracter especial,<br>1 número e 1 letra maiuscula.</span>`

        } else if (senhaCon != senhaVar) {
            msg = `<span style="color: red; font-weight: bold;"> *Confirmação de senhaVar inválida.</span>`
        } else {

            msg = `<span style="color: green; font-weight: bold;">Cadastro Realizado com sucesso!</span>`
        }
        res.innerHTML = ' '
        res.innerHTML = msg


          fetch("/usuarios/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        nomeServer: nomeVar,
        emailServer: emailVar,
        senhaServer: senhaVar,
      }),
    })
      .then(function (resposta) {
        if (resposta.ok) {
          alert("Cadastro realizado com sucesso! Redirecionando para tela de Login...");
          setTimeout(() => {
            trocar();
          }, 800);
        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });

    return false;
    }


     function entrar() {
            
        var usuarioVar = input_email_login.value;
        var senhaVar = input_senha_login.value;
        var mensagem = '';

        if (usuarioVar == '') {
            mensagem = 'O campo de email não pode estar vazio.';
        } else if (!usuarioVar.includes('@') || !usuarioVar.includes('.')) {
            mensagem = 'Digite um email válido.';
        }

        if (mensagem == '') {
            if (senhaVar == '') {
                mensagem = 'O campo de senhaVar não pode estar vazio.';
            } else if (senhaVar.length < 8) {
                mensagem = 'A senhaVar deve ter pelo menos 8 caracteres.';
            }
        }
        if (mensagem != '') {
            msg.style = "color: red; font-weight: bold;"
            msg.innerHTML = mensagem;
            
            return;
        }

        if (usuarioVar == 'vitor@sptech.school' && senhaVar == 'Vitor@123') {
            msg.style = "color: green; font-weight: bold;"
            msg.innerHTML = 'Bem-vindo Vitor!';
            
        } else {
            msg.style = "color: red; font-weight: bold;";
            msg.innerHTML = 'Credenciais inválidas';
            
        }

         

    if (usuarioVar === "" || senhaVar === "") {
      alert("Todos os campos são obrigatórios!");
      return false;
    }

    fetch("/usuarios/autenticar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        emailServer: usuarioVar,
        senhaServer: senhaVar,
      }),
    })
      .then(function (resposta) {
        if (resposta.ok) {
          resposta.json().then((json) => {
            sessionStorage.EMAIL_USUARIO = json.email;
            sessionStorage.NOME_USUARIO = json.nome;
            sessionStorage.ID_USUARIO = json.idUsuario;

            alert("Login realizado com sucesso!");
            window.location = "./dashboard/dashboard.html";
          });
        } else {
          throw "Usuário ou senhaVar inválidos!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
        erro_login.style.opacity = '1'
      });

    return false;

    }

</script>